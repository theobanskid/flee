class p{addOptionsErrors(e){for(let t in e){let n=this.getInputFieldForErrorKey(t);n.closest(".option").addClass("option-has-errors"),n.parent().append(`<span class="help-block">${e[t][0]}</span>`)}}getRowTemplate(e){let t=_.template($("#option-select-values-template").html());return $(t(e))}changeOptionType({optionId:e,type:t,values:n=[]}){let o=this.getOptionValuesElement(e),i=this.getTemplateType(t,o),l={optionId:e,value:{id:"",label:"",price:"",price_type:"fixed"}};if(this.shouldNotChangeTemplate(i,o))return;n.length!==0&&i==="text"&&(l.value=n[0]);let r=_.template($(`#option-${i}-template`).html());o.html(r(l)),i==="select"&&(this.addOptionRowEventListener(e),this.addOptionRows({optionId:e,values:n}),n.length===0&&this.getAddNewRowButton(e).trigger("click"))}addOptionRows({optionId:e,values:t}){for(let[n,o]of t.entries())this.addOptionRow({optionId:e,valueId:n,value:o})}getTemplateType(e){if(this.templateTypeIsText(e))return"text";if(this.templateTypeIsSelect(e))return"select"}templateTypeIsText(e){return["field","textarea","date","date_time","time"].includes(e)}templateTypeIsSelect(e){return["dropdown","checkbox","checkbox_custom","radio","radio_custom","multiple_select"].includes(e)}shouldNotChangeTemplate(e,t){return e===void 0||this.alreadyHasCurrentTemplate(e,t)}alreadyHasCurrentTemplate(e,t){if(e==="text")return t.children().hasClass("option-text");if(e==="select")return t.children().hasClass("option-select")}initOptionRow(e,t){t.length!==0&&!t.is(".sortable")&&(this.makeSortable(t[0]),t.addClass("sortable")),this.deleteOptionRowEventListener(e),window.admin.tooltip()}deleteOptionRowEventListener(e){e.find(".delete-row").on("click",t=>{$(t.currentTarget).closest(".option-row").remove()})}makeSortable(e){Sortable.create(e,{handle:".drag-handle",animation:150})}}class s extends p{constructor(){super();let e=FleetCart.data["option.values"];$("#type").on("change",t=>{super.changeOptionType({type:t.currentTarget.value,values:e}),super.addOptionsErrors(FleetCart.errors["option.values"])}),$("#type").trigger("change"),window.admin.removeSubmitButtonOffsetOn("#values")}addOptionRow({valueId:e,value:t={label:"",price:"",price_type:"fixed"}}){let n=this.getRowTemplate({optionId:void 0,valueId:e,value:t}),o=$("#select-values").append(n);super.initOptionRow(n,o)}addOptionRowEventListener(){$("#add-new-row").on("click",()=>{let e=$("#option-values .option-row").length;this.addOptionRow({valueId:e})})}getOptionValuesElement(){return $("#option-values")}getAddNewRowButton(){return $("#add-new-row")}getInputFieldForErrorKey(e){let t=e.split(".");return t=t.map(n=>n.split("_").join("-")),$(`#${t.join("-")}`)}}$("#option-create-form, #option-edit-form").length!==0&&new s;
