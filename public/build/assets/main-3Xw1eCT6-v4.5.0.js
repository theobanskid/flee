import{E as i}from"./Errors-C30A2Jtx-v4.5.0.js";Alpine.data("Addresses",({initialAddresses:e,initialDefaultAddress:r,countries:a})=>({addresses:e,defaultAddress:r,countries:a,formOpen:!1,editing:!1,loading:!1,form:{state:""},states:{},errors:new i,get firstCountry(){return Object.keys(this.countries)[0]},get hasAddress(){return Object.keys(this.addresses).length!==0},get hasNoStates(){return Object.keys(this.states).length===0},init(){this.changeCountry(this.firstCountry)},changeDefaultAddress(s){this.defaultAddress.address_id!==s.id&&(this.defaultAddress.address_id=s.id,axios.post(route("account.addresses.change_default"),{address_id:s.id}).then(t=>{notify(t.data)}).catch(t=>{notify(t.response.data.message)}))},changeCountry(s){this.form.country=s,this.form.state="",this.fetchStates(s)},async fetchStates(s){const t=await axios.get(route("countries.states.index",{code:s}));this.states=t.data},edit(s){this.formOpen=!0,this.editing=!0,this.form=s,this.fetchStates(s.country)},remove(s){confirm(trans("storefront::account.addresses.confirm"))&&axios.delete(route("account.addresses.destroy",s.id)).then(t=>{delete this.addresses[s.id],notify(t.data.message)}).catch(t=>{notify(t.response.data.message)})},cancel(){this.editing=!1,this.formOpen=!1,this.errors.reset(),this.resetForm()},save(){this.loading=!0,this.editing?this.update():this.create()},update(){axios.put(route("account.addresses.update",{id:this.form.id}),this.form).then(({data:s})=>{this.formOpen=!1,this.editing=!1,this.addresses[this.form.id]=s.address,this.resetForm(),notify(s.message)}).catch(({response:s})=>{s.status===422&&this.errors.record(s.data.errors),notify(s.data.message)}).finally(()=>{this.loading=!1})},create(){axios.post(route("account.addresses.store"),this.form).then(({data:s})=>{this.formOpen=!1;let t={[s.address.id]:s.address};this.addresses={...this.addresses,...t},this.resetForm(),notify(s.message)}).catch(({response:s})=>{s.status===422&&this.errors.record(s.data.errors),notify(s.data.message)}).finally(()=>{this.loading=!1})},resetForm(){this.form={state:""}}}));
